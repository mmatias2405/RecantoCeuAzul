
CREATE DATABASE IF NOT EXISTS recantoceuazul;
USE recantoceuazul;

CREATE TABLE IF NOT EXISTS ator (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(100),
    telefone VARCHAR(15),
    nome VARCHAR(100),
    senha VARCHAR(255),
    papel VARCHAR (5)
);

CREATE TABLE IF NOT EXISTS medicao (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    volume_agua FLOAT,
    delta FLOAT,
    data_medicao DATETIME,
    fk_Residencia_id INTEGER,
    fk_Ator_id INTEGER
);

CREATE TABLE IF NOT EXISTS residencia (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    numero INTEGER
);

CREATE TABLE IF NOT EXISTS possuir (
    fk_Ator_id INTEGER,
    fk_Residencia_id INTEGER
);
 
ALTER TABLE medicao ADD CONSTRAINT FK_Medicao_2
    FOREIGN KEY (fk_Residencia_id)
    REFERENCES residencia (id)
    ON DELETE CASCADE;
 
ALTER TABLE medicao ADD CONSTRAINT FK_Medicao_3
    FOREIGN KEY (fk_Ator_id)
    REFERENCES ator (id)
    ON DELETE SET NULL;
 
ALTER TABLE possuir ADD CONSTRAINT FK_Possuir_1
    FOREIGN KEY (fk_Ator_id)
    REFERENCES ator (id)
    ON DELETE RESTRICT;
 
ALTER TABLE possuir ADD CONSTRAINT FK_Possuir_2
    FOREIGN KEY (fk_Residencia_id)
    REFERENCES residencia (id)
    ON DELETE SET NULL;

/* Populando o Banco de dados */
INSERT INTO ator (email, telefone, nome, senha, papel) VALUES
-- ID 1 (Admin)
('admin@recanto.com', '(11) 90000-0001', 'Administrador Sistema', 'senha123', 'ADMIN'),

-- ID 2 (Fiscal)
('fiscal@recanto.com', '(11) 90000-0002', 'Fiscal de Medição', 'senha123', 'FISCA'), 

-- IDs 3-17 (15 Moradores)
('ana.silva@email.com', '(11) 91111-1111', 'Ana Silva', 'senha123', 'MORAR'),
('bruno.costa@email.com', '(11) 92222-2222', 'Bruno Costa', 'senha123', 'MORAR'),
('carla.dias@email.com', '(11) 93333-3333', 'Carla Dias', 'senha123', 'MORAR'),
('diego.fernandes@email.com', '(11) 94444-4444', 'Diego Fernandes', 'senha123', 'MORAR'),
('elisa.gomes@email.com', '(11) 95555-5555', 'Elisa Gomes', 'senha123', 'MORAR'),
('fabio.lima@email.com', '(11) 96666-6666', 'Fabio Lima', 'senha123', 'MORAR'),
('gabriela.melo@email.com', '(11) 97777-7777', 'Gabriela Melo', 'senha123', 'MORAR'),
('heitor.nunes@email.com', '(11) 98888-8888', 'Heitor Nunes', 'senha123', 'MORAR'),
('isabela.oliveira@email.com', '(11) 99999-9999', 'Isabela Oliveira', 'senha123', 'MORAR'),
('joao.pereira@email.com', '(11) 91010-1010', 'João Pereira', 'senha123', 'MORAR'),
('larissa.ribeiro@email.com', '(11) 92020-2020', 'Larissa Ribeiro', 'senha123', 'MORAR'),
('marcos.souza@email.com', '(11) 93030-3030', 'Marcos Souza', 'senha123', 'MORAR'),
('natalia.vieira@email.com', '(11) 94040-4040', 'Natalia Vieira', 'senha123', 'MORAR'),
('paulo.roberto@email.com', '(11) 95050-5050', 'Paulo Roberto', 'senha123', 'MORAR'),
('raquel.santos@email.com', '(11) 96060-6060', 'Raquel Santos', 'senha123', 'MORAR');


-- -----------------------------------------------------------------
-- 2. INSERIR 20 RESIDÊNCIAS
-- -----------------------------------------------------------------
-- IDs 1-20

INSERT INTO residencia (numero) VALUES
(101), (102), (103), (104), (105), (106), (107), (108), (109), (110),
(111), (112), (113), (114), (115), (116), (117), (118), (119), (120);


-- -----------------------------------------------------------------
-- 3. ASSOCIAR MORADORES E RESIDÊNCIAS (TABELA 'possuir')
-- -----------------------------------------------------------------
-- Vamos cumprir as regras:
-- 1. Todas as 20 residências ocupadas.
-- 2. Alguns moradores com 2 residências.
-- 3. Algumas residências com 2 ou 3 moradores.

INSERT INTO possuir (fk_Ator_id, fk_Residencia_id) VALUES
-- Moradores (IDs 3-17) | Residências (IDs 1-20)

-- 1. Dando uma residência para cada um dos 15 moradores
-- (Ocupa as residências 1-15)
(3, 1), (4, 2), (5, 3), (6, 4), (7, 5), (8, 6), (9, 7), (10, 8),
(11, 9), (12, 10), (13, 11), (14, 12), (15, 13), (16, 14), (17, 15),

-- 2. Ocupando as 5 residências restantes (IDs 16-20)
-- (Isso também satisfaz "alguns moradores têm duas residências")
(3, 16),  -- Morador 3 agora tem 2 residências (Res 1 e 16)
(4, 17),  -- Morador 4 agora tem 2 residências (Res 2 e 17)
(5, 18),  -- Morador 5 agora tem 2 residências (Res 3 e 18)
(6, 19),  -- Morador 6 agora tem 2 residências (Res 4 e 19)
(7, 20),  -- Morador 7 agora tem 2 residências (Res 5 e 20)

-- 3. Satisfazendo "algumas residências têm 2 ou 3 moradores"
-- (Adicionando mais moradores a residências existentes)

-- Residência 1 (ID 1) agora terá 3 moradores (Morador 3, 8, 9)
(8, 1),
(9, 1),

-- Residência 2 (ID 2) agora terá 2 moradores (Morador 4, 10)
(10, 2),

-- Residência 5 (ID 5) agora terá 2 moradores (Morador 7, 11)
(11, 5);


-- -----------------------------------------------------------------
-- 4. GERAR MEDIÇÕES FICTICIAS de MAIO/2025 a OUTUBRO/2025 para as 20 residencias
-- -----------------------------------------------------------------
INSERT INTO `medicao` VALUES (1,1169.07,14.04,'2025-05-28 09:00:00',1,2),(2,1183.83,14.75,'2025-06-28 09:00:00',1,2),(3,1199.48,15.65,'2025-07-28 09:00:00',1,2),(4,1209.46,9.99,'2025-08-28 09:00:00',1,2),(5,1220.45,10.99,'2025-09-28 09:00:00',1,2),(6,1229.42,8.97,'2025-10-28 09:00:00',1,2),(7,1251.39,8.52,'2025-05-28 09:00:00',2,2),(8,1266.35,14.96,'2025-06-28 09:00:00',2,2),(9,1275.58,9.23,'2025-07-28 09:00:00',2,2),(10,1284.85,9.27,'2025-08-28 09:00:00',2,2),(11,1295.5,10.65,'2025-09-28 09:00:00',2,2),(12,1304.93,9.44,'2025-10-28 09:00:00',2,2),(13,1468.21,15.88,'2025-05-28 09:00:00',3,2),(14,1477.89,9.68,'2025-06-28 09:00:00',3,2),(15,1486.66,8.77,'2025-07-28 09:00:00',3,2),(16,1501.45,14.8,'2025-08-28 09:00:00',3,2),(17,1517.13,15.68,'2025-09-28 09:00:00',3,2),(18,1527.13,10,'2025-10-28 09:00:00',3,2),(19,1195.53,8.92,'2025-05-28 09:00:00',4,2),(20,1207.15,11.62,'2025-06-28 09:00:00',4,2),(21,1222.52,15.36,'2025-07-28 09:00:00',4,2),(22,1232.47,9.96,'2025-08-28 09:00:00',4,2),(23,1244.16,11.69,'2025-09-28 09:00:00',4,2),(24,1256.73,12.57,'2025-10-28 09:00:00',4,2),(25,1249.11,13.17,'2025-05-28 09:00:00',5,2),(26,1263.65,14.54,'2025-06-28 09:00:00',5,2),(27,1272.83,9.18,'2025-07-28 09:00:00',5,2),(28,1283.1,10.27,'2025-08-28 09:00:00',5,2),(29,1298.93,15.83,'2025-09-28 09:00:00',5,2),(30,1307.25,8.32,'2025-10-28 09:00:00',5,2),(31,1142.77,9.68,'2025-05-28 09:00:00',6,2),(32,1152.78,10.01,'2025-06-28 09:00:00',6,2),(33,1165.79,13,'2025-07-28 09:00:00',6,2),(34,1176.79,11,'2025-08-28 09:00:00',6,2),(35,1192.76,15.98,'2025-09-28 09:00:00',6,2),(36,1207.64,14.88,'2025-10-28 09:00:00',6,2),(37,1171.39,15.8,'2025-05-28 09:00:00',7,2),(38,1186.91,15.52,'2025-06-28 09:00:00',7,2),(39,1201.12,14.21,'2025-07-28 09:00:00',7,2),(40,1209.61,8.49,'2025-08-28 09:00:00',7,2),(41,1225.43,15.82,'2025-09-28 09:00:00',7,2),(42,1239.07,13.64,'2025-10-28 09:00:00',7,2),(43,1309.76,14.69,'2025-05-28 09:00:00',8,2),(44,1321.07,11.3,'2025-06-28 09:00:00',8,2),(45,1333.51,12.44,'2025-07-28 09:00:00',8,2),(46,1345.79,12.28,'2025-08-28 09:00:00',8,2),(47,1353.89,8.1,'2025-09-28 09:00:00',8,2),(48,1365.54,11.65,'2025-10-28 09:00:00',8,2),(49,1137.62,14.86,'2025-05-28 09:00:00',9,2),(50,1150.03,12.41,'2025-06-28 09:00:00',9,2),(51,1159.51,9.48,'2025-07-28 09:00:00',9,2),(52,1169.65,10.15,'2025-08-28 09:00:00',9,2),(53,1183.95,14.3,'2025-09-28 09:00:00',9,2),(54,1193,9.05,'2025-10-28 09:00:00',9,2),(55,1156.61,8.68,'2025-05-28 09:00:00',10,2),(56,1168.9,12.29,'2025-06-28 09:00:00',10,2),(57,1180.33,11.43,'2025-07-28 09:00:00',10,2),(58,1192.59,12.26,'2025-08-28 09:00:00',10,2),(59,1203.62,11.03,'2025-09-28 09:00:00',10,2),(60,1213.97,10.35,'2025-10-28 09:00:00',10,2),(61,1181.63,14.33,'2025-05-28 09:00:00',11,2),(62,1197.24,15.61,'2025-06-28 09:00:00',11,2),(63,1208.31,11.06,'2025-07-28 09:00:00',11,2),(64,1216.79,8.49,'2025-08-28 09:00:00',11,2),(65,1226.03,9.24,'2025-09-28 09:00:00',11,2),(66,1238.79,12.75,'2025-10-28 09:00:00',11,2),(67,1266.26,13.93,'2025-05-28 09:00:00',12,2),(68,1275.79,9.53,'2025-06-28 09:00:00',12,2),(69,1289.65,13.86,'2025-07-28 09:00:00',12,2),(70,1298.36,8.71,'2025-08-28 09:00:00',12,2),(71,1308.33,9.97,'2025-09-28 09:00:00',12,2),(72,1324.08,15.74,'2025-10-28 09:00:00',12,2),(73,1061.9,12.71,'2025-05-28 09:00:00',13,2),(74,1075.08,13.18,'2025-06-28 09:00:00',13,2),(75,1086.86,11.78,'2025-07-28 09:00:00',13,2),(76,1098.23,11.36,'2025-08-28 09:00:00',13,2),(77,1111.7,13.47,'2025-09-28 09:00:00',13,2),(78,1120.97,9.27,'2025-10-28 09:00:00',13,2),(79,1381.81,9.93,'2025-05-28 09:00:00',14,2),(80,1397.61,15.8,'2025-06-28 09:00:00',14,2),(81,1406.8,9.19,'2025-07-28 09:00:00',14,2),(82,1421.38,14.58,'2025-08-28 09:00:00',14,2),(83,1434.71,13.33,'2025-09-28 09:00:00',14,2),(84,1449.59,14.88,'2025-10-28 09:00:00',14,2),(85,1167.41,15.51,'2025-05-28 09:00:00',15,2),(86,1181.66,14.25,'2025-06-28 09:00:00',15,2),(87,1190.39,8.73,'2025-07-28 09:00:00',15,2),(88,1199.28,8.89,'2025-08-28 09:00:00',15,2),(89,1209.54,10.27,'2025-09-28 09:00:00',15,2),(90,1218.2,8.66,'2025-10-28 09:00:00',15,2),(91,1292.62,12.45,'2025-05-28 09:00:00',16,2),(92,1301.41,8.79,'2025-06-28 09:00:00',16,2),(93,1315.99,14.59,'2025-07-28 09:00:00',16,2),(94,1330.58,14.58,'2025-08-28 09:00:00',16,2),(95,1343.73,13.15,'2025-09-28 09:00:00',16,2),(96,1357.73,14,'2025-10-28 09:00:00',16,2),(97,1425.32,14.83,'2025-05-28 09:00:00',17,2),(98,1439.76,14.44,'2025-06-28 09:00:00',17,2),(99,1451.45,11.69,'2025-07-28 09:00:00',17,2),(100,1466.6,15.16,'2025-08-28 09:00:00',17,2),(101,1475.3,8.7,'2025-09-28 09:00:00',17,2),(102,1489.33,14.03,'2025-10-28 09:00:00',17,2),(103,1264.17,10.22,'2025-05-28 09:00:00',18,2),(104,1279.08,14.91,'2025-06-28 09:00:00',18,2),(105,1290.95,11.87,'2025-07-28 09:00:00',18,2),(106,1305.58,14.63,'2025-08-28 09:00:00',18,2),(107,1319.13,13.56,'2025-09-28 09:00:00',18,2),(108,1335.01,15.88,'2025-10-28 09:00:00',18,2),(109,1429.85,9.96,'2025-05-28 09:00:00',19,2),(110,1443.5,13.65,'2025-06-28 09:00:00',19,2),(111,1457.88,14.37,'2025-07-28 09:00:00',19,2),(112,1472.79,14.91,'2025-08-28 09:00:00',19,2),(113,1488.21,15.43,'2025-09-28 09:00:00',19,2),(114,1496.62,8.41,'2025-10-28 09:00:00',19,2),(115,1245.55,9.64,'2025-05-28 09:00:00',20,2),(116,1258.42,12.87,'2025-06-28 09:00:00',20,2),(117,1269.84,11.42,'2025-07-28 09:00:00',20,2),(118,1280.35,10.51,'2025-08-28 09:00:00',20,2),(119,1290.64,10.29,'2025-09-28 09:00:00',20,2),(120,1302.56,11.92,'2025-10-28 09:00:00',20,2);
